import time
import os
from port_scanner import print_section  # If needed — adjust based on your structure


def assess_vulnerabilities():
    print_section("SECTION 4: VULNERABILITY ASSESSMENT")

    vulnerabilities = []
    print("Testing for common vulnerabilities...\n")

    # TEST 1 — Database security
    print("[TEST 1] Database Security")
    if os.path.exists('users.json'):
        print("  Finding: Using JSON file database")
        print("  Risk: MEDIUM - Data not encrypted")
        print("  Recommendation: Use encrypted database (PostgreSQL)\n")
        vulnerabilities.append("Unencrypted database storage")

    # TEST 2 — Rate limiting
    print("[TEST 2] Rate Limiting")
    print("  Simulating multiple login attempts...")
    for _ in range(10):
        time.sleep(0.05)
    print("  Finding: No rate limiting detected")
    vulnerabilities.append("No rate limiting on authentication")

    # TEST 3 — Audit logging
    print("[TEST 3] Audit Logging")
    log_files = ['auth.log', 'security.log', 'audit.log']
    if not any(os.path.exists(f) for f in log_files):
        print("  Finding: No audit logs detected")
        vulnerabilities.append("No audit logging")

    # TEST 4 — Session management
    print("[TEST 4] Session Management")
    if not any(os.path.exists(f) for f in ['sessions.json', 'tokens.db']):
        print("  Finding: No session management detected")
        vulnerabilities.append("No session management")

    print(f"\nAssessment complete: {len(vulnerabilities)} vulnerability(ies) found")
    return vulnerabilities
